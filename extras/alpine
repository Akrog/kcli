FROM alpine:3.15

MAINTAINER Karim Boumedhel <karimboumedhel@gmail.com>

LABEL name="karmab/kcli" \
      maintainer="karimboumedhel@gmail.com" \
      vendor="Karmalabs" \
      version="latest" \
      release="0" \
      summary="Virtualization wrapper" \
      description="Virtualization wrapper"

EXPOSE 9000

RUN mkdir /root/kcli
ADD kvirt /root/kcli/kvirt
COPY setup.py /root/kcli
ENV CRYPTOGRAPHY_DONT_BUILD_RUST=1
RUN apk add --update --no-cache g++ gcc libvirt libvirt-dev libc6-compat python3-dev openssh-client curl curl-dev libressl-dev libxml2-dev linux-headers libffi-dev cdrkit xauth bash py3-pip py3-wheel && pip3 install -U pip && pip3 install --no-cache -e /root/kcli[all] && apk del g++ gcc libvirt-dev curl-dev libressl-dev libxml2-dev linux-headers libffi-dev
ADD extras/i_am_a_container /i_am_a_container

RUN echo eval \"\$\(register-python-argcomplete kcli\)\" >> /root/.bashrc

ENTRYPOINT ["/usr/bin/kcli"]
CMD ["-h"]
